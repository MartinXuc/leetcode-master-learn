[toc]

## 使用统一的命名风格

### 常见的命名风格

- 大驼峰：AntiOutlierConfig
- 小驼峰：antiOutlierConfig
- 蛇形：anti_outlier_config
- 匈牙利：uiAntiOutlierConfig

注：匈牙利命名法存在可读性，可维护性问题，已经被现代编程抛弃

### 具体的风格选择

- 具体的风格由项目组自行选择，并保持风格统一
- 推荐使用驼峰命名风格
- 对于更亲和标准库的代码，可以使用标准库命名风格
- 基于开源或外部代码进行开发或维护时，可以保持原有命名风格

### 推荐使用驼峰命名法

- 类名用大驼峰
- 函数用大驼峰
- 变量使用小驼峰
- 全局变量前面额外加上 `_g` 前缀

```cpp
class SomeType { // 类型大驼峰
public:
    int Fun(int a, int b) // 函数大驼峰，参数小驼峰
    {
        int blockCount; // 局部变量小驼峰
        ...
    }
    ...
private:
    int objCount; // 类成员变量小驼峰
    ...
};

SomeType g_fileCount; // 全局变量 g_前缀 + x
```

### 一些好的命名实践

- 使用正确的英文单词及英文语法，不要使用拼音
- 仅使用常见或领域内通用的单词缩写
- 布尔型变量或函数避免使用否定形式
- ...

## 统一文件命名

**C++ 源文件以 .cpp 为扩展名，头文件以 .h 为扩展名**

- 如果当前项目组已经使用了业界其他的扩展名（hh hpp cc cxx）等，那么可以继续使用，并保持风格统一
- C++ 20 中推出的新特性 Modules 的扩展名，可以根据编译器的支持情况选择，例如：cppm ixx 等

**C++ 文件名和类名保持一致**

- C++ 的头文件和源文件名应该和类名保持一致，可以使用大驼峰或者小写下划线风格
- 项目组选择一种风格约定执行，并保持风格统一

如果一个类叫 DatabaseConnection，那么对应的文件名：

- DatabaseConnection.h
- DatabaseConnection.cpp

或者如下：

- database_connection.h
- database_connection.cpp

## 合理使用注释

尽量通过清晰的软件架构、良好的标识符命名来提升代码的可读性，只有在需要的时候，才辅以注释说明，如：难以理解的处理逻辑、对外接口、全局变量等需要添加注释说明。

总结：不要没有注释，也不要弄冗余注释。

## 注释格式

使用 C++ 标准注释方式即可，但是还有一些要求：

- 注释符与注释内容之间应该留有一个空格
- 代码的注释应该置于对应代码的上一行或者右边
- 代码上方的注释与代码中间不应该有空行，且保持一样的缩进
- 代码右边的注释与代码之间需要留一个空格

example：

```cpp
// Foo() 函数的注释
int Foo()
{
    int b = 0; // 变量 b 的注释，与代码至少留有一个空格
}

// 例外场景，函数参数注释
bool Implement::Fun(uint32_t /* phase */)
{
    ...
}
```

## 使用统一的大括号换行风格

- K&R 风格：函数大括号放到下一行开头，其他大括号放到上一行结尾

```cpp
void CheckNegative(int x)
{
    if (x < 0) {
        puts("Negative");
    } else {
        NonNegative(x);
    }
}
```

- 1TBS  风格：所有大括号放到上一行结尾，类似 Java 语言

```cpp
void CheckNegative(int x) {
    if (x < 0) {
        puts("Negative");
    } else {
        NonNegative(x);
    }
}
```

- Allman 风格：所有大括号都放到下一行的开头

```cpp
void CheckNegative(int x) 
{
    if (x < 0) 
    {
        puts("Negative");
    } 
    else
    {
        NonNegative(x);
    }
}
```

至于哪种大括号风格是更好的，没有定论。本规范建议使用 K&R 风格。

## 行宽不超过 120 个字符

代码行宽上限，不是取决于屏幕宽度，而是人眼跟踪范围，报纸中的多栏结构其实也是这里理论的应用。

当行宽过长的时候，从可读性出发，需要强制换行，具体操作：

- 在较低优先级操作符后换行，操作符留在行尾
- 新行按层次缩进或者按同类对齐
- 不破坏局部完整性
- 不要拿行宽上限作为断行依据

```cpp
if (currentValue > MIN && // 符合：换行后，布尔操作符放在行末
    currentValue < MAX) { // 符合：与（&&）操作符的两个操作数同类对齐
    DoSomething();
    ...
}
flashPara.endAddr = flashPara.baseAddr + // 符合：加号留在行末
    				flashPara.size;      // 符合：加法两个操作数对齐

// 符合：换行后 4 空格缩进
int sum = longVaribleName1 + longVaribleName2 + longVaribleName3 +
    longVaribleName4 + longVaribleName5 + longVaribleName6;
```

## 其他规范的排版格式：

```cpp
class SomeClass {
public:
    explicit SomeClass(int var) : someVar(var)
    {
        DoSomething();
    }
    ...
    
private:
    ...
};

int Fun(char type, const std::string& name)
{
    if (type < 'a' || type > 'z') {
        return -1;
    }
    
    switch (type) {
        case 'c':
            ...
        case 'd':
            ...
        default:
            return -1;
    }
    ...
}
```

1. 遵循传统的类成员声明顺序：

```
公有部分（Public）
	类型定义（typedef、enum、using 等）
	静态常量（static const 或 static constexpr）
	构造函数
	析构函数
	重载运算符（如 operator+, operator= 等）
	普通成员函数（接口方法）
	静态成员函数
保护部分（Protected）
	成员变量（数据）
	成员函数（辅助方法）
私有部分（Private）
	成员变量（数据）
	成员函数（辅助方法）
	静态成员变量
```

2. 每次缩进 4 个空格。
3. 构造函数初始化列表放在同一行或缩进并排多行。
4. 指针类型 “\*” 和引用类型 “&” 只跟随类型或变量名，选择一种保持一致。
5. 选择、循环语句使用大括号，即使缩进块只有一行。
6. case / default 语句相对 switch 缩进一层
7. 关于空格：
    1. 用空格突出关键字和重要信息
    2. 行末不要加空格
    3. if switch case do while for 等关键字后面加空格
    4. 双目运算符两边留空格，逗号后面留空格
    5. 小括号内部的两侧不加空格
    6. 大括号内部两侧是否有空格，左右一致
